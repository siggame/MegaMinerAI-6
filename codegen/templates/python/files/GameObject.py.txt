# -*- python -*-

from library import library

from ExistentialError import ExistentialError

class GameObject(object):
  def __init__(self, ptr):
    from BaseAI import BaseAI
    self.ptr = ptr
    self.iteration = BaseAI.iteration

% for model in models:

%   if model.parent:
class ${model.name}(${model.parent.name}):
%   else:
class ${model.name}(GameObject):
%   endif
%  if model.doc:
  """${model.doc}
  """
%  endif
  def __init__(self, ptr):
    from BaseAI import BaseAI
    self.ptr = ptr
    self.iteration = BaseAI.iteration
    
    self.ID = library.${lowercase(model.name)}GetId(ptr)

%   if model.type == 'Model':
  def validify(self):
    from BaseAI import BaseAI
    #if this class is pointing to an object from before the current turn it's probably
    #somewhere else in memory now
    if self.iteration == BaseAI.iteration:
      return True
    for i in BaseAI.${lowercase(model.plural)}:
      if i.id == self.id:
        self.ptr = i.ptr
        self.iteration = BaseAI.iteration
        return True
    raise ExistentialError()
%   endif

%  for func in model.functions:
  def ${func.name}(self\
%    for arg in func.arguments:
, ${arg.name}\
%    endfor
):
    self.validify()
%    for arg in func.arguments:
%      if isinstance(arg.type, Model):
    if ${arg.name}.__class__ not in [${arg.type.name}]:
      raise TypeError('${arg.name} should be of [${arg.type.name}]')
    ${arg.name}.validify()
%      endif
%    endfor
    return library.${lowercase(model.name)}${capitalize(func.name)}(self.ptr\
%    for arg in func.arguments:
, ${arg.name}\
%    endfor
)

%  endfor
%  for datum in model.data:
  def get${capitalize(datum.name)}(self):
    self.validify()
    return library.${lowercase(model.name)}Get${capitalize(datum.name)}(self.ptr)

%  endfor
%endfor
